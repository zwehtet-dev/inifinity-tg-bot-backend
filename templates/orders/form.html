{% extends "base.html" %}
{% block title %}Order Details{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto bg-gray-800 rounded-xl shadow-lg p-8">
    <div class="flex items-center justify-between mb-6">
        <h2 class="text-3xl font-bold flex items-center gap-2">
            <i class="fas fa-file-invoice-dollar text-blue-400"></i>
            Order #{{ order.order_id }}
        </h2>
        <form method="post" class="flex items-center gap-2">

            <select name="status" class="px-4 py-1 rounded-full text-sm font-semibold
            {% if order.status == 'approved' %}
                bg-green-600 text-white
            {% elif order.status == 'pending' %}
                bg-yellow-500 text-gray-900
            {% elif order.status == 'declined' %}
                bg-red-600 text-white
            {% elif order.status == 'complain' %}
                bg-orange-600 text-white
            {% else %}
                bg-gray-600 text-white
            {% endif %}
            ">
            <option value="pending" {% if order.status == 'pending' %}selected{% endif %}>Pending</option>
            <option value="approved" {% if order.status == 'approved' %}selected{% endif %}>Approved</option>
            <option value="declined" {% if order.status == 'declined' %}selected{% endif %}>Declined</option>
            <option value="complain" {% if order.status == 'complain' %}selected{% endif %}>Complain</option>
            </select>
            <button type="submit" class="ml-2 px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm font-semibold">
            Update
            </button>
        </form>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
            <h3 class="text-lg font-semibold mb-2 text-gray-300">Order Info</h3>
            <ul class="space-y-2">
                <li>
                    <span class="font-semibold text-gray-400">Type:</span>
                    <span class="capitalize">{{ order.order_type }}</span>
                </li>
                <li>
                    <span class="font-semibold text-gray-400">Amount:</span>
                    <span>{{ order.amount }}</span>
                </li>
                <li>
                    <span class="font-semibold text-gray-400">Price:</span>
                    <span>{{ order.price }}</span>
                </li>
                <li>
                    <span class="font-semibold text-gray-400">Created At:</span>
                    <span>{{ order.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
                </li>
            </ul>
        </div>
        <div>
            <h3 class="text-lg font-semibold mb-2 text-gray-300">User</h3>
            <ul class="space-y-2">
                <li>
                    <span class="font-semibold text-gray-400">Name:</span>
                    <span>{{ order.user.name if order.user else '-' }}</span>
                </li>
                <li>
                    <span class="font-semibold text-gray-400">Phone:</span>
                    <span>{{ order.user.phone if order.user else '-' }}</span>
                </li>
            </ul>
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
        <div>
            <h3 class="text-lg font-semibold mb-2 text-gray-300">Thai Bank Account</h3>
            {% if order.thai_bank_account %}
            <ul class="space-y-2">
                <li>
                    <span class="font-semibold text-gray-400">Bank:</span>
                    <span>{{ order.thai_bank_account.bank_name }}</span>
                </li>
                <li>
                    <span class="font-semibold text-gray-400">Account Name:</span>
                    <span>{{ order.thai_bank_account.account_name }}</span>
                </li>
                <li>
                    <span class="font-semibold text-gray-400">Account Number:</span>
                    <span>{{ order.thai_bank_account.account_number }}</span>
                </li>
                {% if order.thai_bank_account.qr_image %}
                <li>
                    <span class="font-semibold text-gray-400">QR:</span>
                    <img src="{{ order.thai_bank_account.qr_image }}" alt="Thai Bank QR" class="w-32 h-32 rounded shadow mt-2">
                </li>
                {% endif %}
            </ul>
            {% else %}
            <p class="text-gray-500">-</p>
            {% endif %}
        </div>
        <div>
            <h3 class="text-lg font-semibold mb-2 text-gray-300">Myanmar Bank Account</h3>
            {% if order.myanmar_bank_account %}
            <ul class="space-y-2">
                <li>
                    <span class="font-semibold text-gray-400">Bank:</span>
                    <span>{{ order.myanmar_bank_account.bank_name }}</span>
                </li>
                <li>
                    <span class="font-semibold text-gray-400">Account Name:</span>
                    <span>{{ order.myanmar_bank_account.account_name }}</span>
                </li>
                <li>
                    <span class="font-semibold text-gray-400">Account Number:</span>
                    <span>{{ order.myanmar_bank_account.account_number }}</span>
                </li>
                {% if order.myanmar_bank_account.qr_image %}
                <li>
                    <span class="font-semibold text-gray-400">QR:</span>
                    <img src="{{ order.myanmar_bank_account.qr_image }}" alt="Myanmar Bank QR" class="w-32 h-32 rounded shadow mt-2">
                </li>
                {% endif %}
            </ul>
            {% else %}
            <p class="text-gray-500">-</p>
            {% endif %}
        </div>
    </div>

    <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
            <h3 class="text-lg font-semibold mb-2 text-gray-300">Receipt</h3>
            {% if order.receipt %}
                <img src="/{{ order.receipt }}" alt="Receipt" class="w-48 h-48 rounded shadow border border-gray-700">
            {% else %}
                <p class="text-gray-500">No receipt uploaded.</p>
            {% endif %}
        </div>
        <div>
            <h3 class="text-lg font-semibold mb-2 text-gray-300">Confirm Receipt</h3>
            {% if order.confirm_receipt %}
                <img src="{{ order.confirm_receipt }}" alt="Confirm Receipt" class="w-48 h-48 rounded shadow border border-gray-700 mb-4">
            {% else %}
                <p class="text-gray-500 mb-4">No confirm receipt uploaded.</p>
            {% endif %}
            <form method="post" enctype="multipart/form-data" class="flex flex-col gap-2">

                <input type="file" name="confirm_receipt" accept="image/*" class="block w-full text-sm text-gray-300 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-600 file:text-white hover:file:bg-blue-700" onchange="previewConfirmReceipt(event)">
                <img id="confirm-receipt-preview" src="#" alt="Preview" class="hidden w-32 h-32 rounded shadow border border-gray-700 mt-2" />
                <script>
                    function previewConfirmReceipt(event) {
                        const [file] = event.target.files;
                        const preview = document.getElementById('confirm-receipt-preview');
                        if (file) {
                            preview.src = URL.createObjectURL(file);
                            preview.classList.remove('hidden');
                        } else {
                            preview.src = '#';
                            preview.classList.add('hidden');
                        }
                    }
                </script>
                <button type="submit" name="upload_confirm_receipt" class="mt-2 px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm font-semibold">
                    Upload
                </button>
            </form>
        </div>
        <!-- <div>
            <h3 class="text-lg font-semibold mb-2 text-gray-300">Order QR</h3>
            {% if order.qr %}
                <img src="{{ order.qr }}" alt="Order QR" class="w-48 h-48 rounded shadow border border-gray-700">
            {% else %}
                <p class="text-gray-500">No QR available.</p>
            {% endif %}
        </div> -->
    </div>
</div>
{% endblock %}